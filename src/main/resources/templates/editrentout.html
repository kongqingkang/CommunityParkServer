<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <!--initial-scale缩放比例-->
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>出租信息修改</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
    <link rel="stylesheet" href="/CommunityPark/css/me.css">
</head>
<body>
<!--导航-->
<!--导航-->
<nav class="ui inverted attached segment m-padded-tb-mini m-shadow-small">
    <div class="ui container">
        <div class="ui inverted secondary stackable menu">
            <h2 class="ui teal header item">车位共享</h2>
            <a th:href="@{/index}" href="#" class="m-item item m-mobile-hide"><i class="home icon"></i>首页</a>
            <a th:href="@{/getUserReview}" href="#" class="m-item item m-mobile-hide"><i class="tags icon"></i>认证</a>
            <a th:href="@{/getRentInput}" href="#" class="m-item item m-mobile-hide"><i class="idea icon"></i>发布</a>
            <a th:href="@{/archives}" href="#" class="m-item item m-mobile-hide"><i class="clone icon"></i>归档</a>
            <a th:href="@{/about}" href="#" class="m-item item m-mobile-hide"><i class="info icon"></i>个人信息</a>
            <a th:href="@{/message}" href="#" class="m-item item m-mobile-hide"><i class="comment alternate outline icon"></i>消息</a>
            <div class="right item m-mobile-hide">
                <div id="search_box" class="ui icon inverted input transparent">
                    <!--input要用th:value-->
                    <input type="text" name="query" placeholder="Search..." id="query">
                    <i class="search link icon"></i>
                </div>
                <div class="ui dropdown item" style="margin-left: 50px !important;">
                    <div class="text">
                        <img id="avatarUrl1" src="https://unsplash.it/100/100?image=1006" alt="" class="ui avatar image">
                        <span id="truthName2"></span>
                    </div>
                    <i class="dropdown icon"></i>
                    <div class="menu">
                        <a class="item" onclick=logoutA()>注销</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <a href="#" class="ui menu toggle black icon button m-right-top m-mobile-show">
        <i class="sidebar icon"></i>
    </a>
</nav>
<!--中间-->
<div class="m-container-small m-padded-tb-large">
    <div class="ui container">
       <form class="ui form">
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">标题</label>
                       <input type="text" id="title" name="title" placeholder="请输入标题……">
                   </div>
               </div>
           </div>
            <div class="two fields">
                <div class="required field">
                    <div class="ui left labeled input">
                        <label class="ui compact teal basic label">姓  名</label>
                        <input type="text" id="truthName" name="truthName" placeholder="请输入姓名……">
                    </div>
                </div>
            </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">联系方式</label>
                       <input type="text" id="mobile" name="mobile" placeholder="请输入联系方式……">
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">车位地址</label>
                       <input type="text" id="parkAddress" name="parkAddress" placeholder="请输入车位地址……">
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">车位号</label>
                       <input type="text" id="parkName" name="parkName" placeholder="请输入车位号……如A13">
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui labeled input">
                       <label class="ui compact teal basic label">长租/短租</label>
                       <div class="required inline fields" style="padding-left: 1.5em">
                           <div class="field">
                               <div class="ui radio checkbox">
                                   <input type="radio" name="longFlag" checked="checked" tabindex="0" class="hidden" value="0">
                                   <label class="label" style="font-size: 13pt">长租</label>
                               </div>
                           </div>
                           <div class="field">
                               <div class="ui radio checkbox">
                                   <input type="radio" name="longFlag" tabindex="0" class="hidden" value="1">
                                   <label  style="font-size: 13pt">短租</label>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">时间段</label>
                       <input type="text" id="startTime" name="startTime" placeholder="请按‘2020-4-17’格式输入起始时间……">
                       <span style="padding: 8px 2px 0 2px ">至</span>
                       <input type="text" id="endTime" name="endTime" placeholder="请按‘2020-4-18’输入终止时间……">
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui labeled input">
                       <label class="ui compact teal basic label">是否免费</label>
                       <div class="required inline fields" style="padding-left: 1.5em">
                           <div class="field">
                               <div class="ui radio checkbox">
                                   <input type="radio" name="freeFlag" tabindex="0" class="hidden" value="0">
                                   <label class="label" style="font-size: 13pt">免费</label>
                               </div>
                           </div>
                           <div class="field">
                               <div class="ui radio checkbox">
                                   <input type="radio" name="freeFlag" checked="checked" tabindex="0" class="hidden" value="1">
                                   <label  style="font-size: 13pt">收费</label>
                               </div>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div id="fee" class="ui left labeled input">
                       <label for="price" class="ui compact teal basic label">费用￥</label>
                       <input type="text" id="price" name="price" placeholder="请输入费用……">
                   </div>
               </div>
           </div>
           <div class="two fields">
               <div class="required field">
                   <div class="ui left labeled input">
                       <label class="ui compact teal basic label">备注</label>
                   </div>
                   <textarea id="description" name="description" placeholder="请输入一些介绍信息……"></textarea>
                   </div>
               </div>
            <div class="ui error message"></div>
            <div class="ui center aligned container">
                <button type="button" class="ui button" onclick="window.history.go(-1)">返回</button>
                <button class="ui teal button">修改</button>
            </div>
        </form>
    </div>
</div>
<!--底部-->
<footer th:replace="_fragments::footer" class="ui inverted vertical segment m-padded-tb-massive">
    <div class="ui center aligned container">
        <div class="ui inverted divided stackable grid"><!--stackable代表可堆叠-->
            <div class="three wide column">
                <div class="ui inverted link list">
                    <div class="item">
                        <img src="../static/images/wechat.jpg" class="ui rounded image" alt="" style="width: 7em">
                    </div>
                </div>
            </div>
            <div class="three wide column">
                <h4 class="ui inverted header m-text-thin m-text-lined m-text-sapced">最新发布</h4>
                <div class="ui inverted link list m-text-thin m-opacity-mini m-text-lined m-text-sapced">
                    <a href="#" class="item">用户故事</a>
                    <a href="#" class="item">用户故事</a>
                    <a href="#" class="item">用户故事</a>
                </div>
            </div>
            <div class="four wide column">
                <h4 class="ui inverted header header m-text-thin m-text-lined m-text-sapced">联系我</h4>
                <div class="ui inverted link list m-text-thin m-opacity-mini m-text-lined m-text-sapced">
                    <a href="#" class="item">Email:1170830826@qq.com</a>
                    <a href="#" class="item">QQ:1170830826</a>
                </div>
            </div>
            <div class="six wide column">
                <h4 class="ui inverted header header m-text-thin m-text-lined m-text-sapced">车位平台</h4>
                <p class="m-text-thin m-opacity-mini m-text-lined m-text-sapced">致力于打造一个非常好的社区车位共享平台，为大家带来优质的服务！</p>
            </div>
        </div>
        <div class="ui inverted section divider"></div>
        <p>Copyright © 2019-2020 kongqingkang Designed by kongqingkang</p>
    </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
<script src="/CommunityPark/js/myInfo.js"></script>
<script>
    $('.menu.toggle').click(function () {
        $('.m-item').toggleClass('m-mobile-hide');
    });
    $('.ui.dropdown').dropdown({
        on: 'hover'
    });
    $('.ui.radio.checkbox')
        .checkbox()
    ;
    /**
     * 跳转到出租详情页
     * @param id
     */
    $(document).ready(function(){
        init();
        var rentInfoId = window.location.pathname.split("/")[3];
        $("#truthName").attr("disabled","");
        $("#mobile").attr("disabled","");
        $("#parkAddress").attr("disabled","");
        $("#parkName").attr("disabled","");
        $('input[type=radio][name=freeFlag]').change(function() {
            if (this.value == 0) {
                $("#fee").hide();
            }
            else {
                $("#fee").show();
            }
        });
        $.ajax({
            type: "get",
            sync : false,
            serializeForm: true,
            url: "/CommunityPark/rentOutInfoDetail/"+rentInfoId,
            // contentType:"application/json;charset=UTF-8",
            // dataType: "json",
            success: function (res) {
                console.log(res);
                var data = res.data;
                // if(data.typeId==1){
                //     $("#rentFlag").text("出租");
                // }
                $("#title").val(data.title);
                $("#truthName").val(data.truthName);
                $("#mobile").val(data.mobile);
                $("#parkAddress").val(data.parkAddress);
                $("#parkName").val(data.parkName);
                $("#startTime").val(data.startTime);
                $("#endTime").val(data.endTime);
                $("#description").text(data.description);
                $("#price").val(data.price);
                if (data.longFlag==0){
                    $("input[name='longFlag'][value='0']").attr("checked",true);
                }else{
                    $("input[name='longFlag'][value='1']").attr("checked",true);
                }
                if (data.freeFlag==0){
                    $("input[name='freeFlag'][value='0']").attr("checked",true);
                    $("#fee").hide();
                }else{
                    $("input[name='freeFlag'][value='1']").attr("checked",true);
                    $("#fee").show();
                }
                // if (data.freeFlag==1){
                //     $("#freeFlag").text("收费");
                // }else{
                //     $("#freeFlag").text("免费");
                //     $("#fee").hide();
                // }
                // if(data.selfFlag!=1){//0的时候是别人
                //     $('#confirmGive').attr("style","display:none;");
                //     $('#editRentOut').attr("style","display:none;");
                //     $('#delRentOut').attr("style","display:none;");
                //     //$('#reserve').attr("style","display:none;");
                // }else{
                //     $('#editRentOut').show();
                //     $('#delRentOut').show();
                //     $('#confirmGive').show();
                //     $('#reserve').attr("style","display:none;");
                // }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
                alert(XMLHttpRequest.status);
                alert(XMLHttpRequest.readyState);
                alert(textStatus);
            },
        });
    });
    $('.ui.form').form({
        fields: {
            title: {
                identifier: 'title',
                rules: [{
                    type: 'empty',
                    prompt: '标题：请输入博客标题!'
                }]
            },
            truthName: {
                identifier: 'truthName',
                rules: [{
                    type: 'empty',
                    prompt: '请输入姓名……'
                }]
            },
            mobile: {
                identifier: 'mobile',
                rules: [{
                    type: 'empty',
                    prompt: '请输入手机号……'
                }]
            },
            parkAddress: {
                identifier: 'parkAddress',
                rules: [{
                    type: 'empty',
                    prompt: '请输入车位地址……'
                }]
            },
            parkName: {
                identifier: 'parkName',
                rules: [{
                    type: 'empty',
                    prompt: '请输入车位号……'
                }]
            },
            startTime: {
                identifier: 'startTime',
                rules: [{
                    type: 'empty',
                    prompt: '请输入开始时间……'
                }]
            },
            endTime: {
                identifier: 'endTime',
                rules: [{
                    type: 'empty',
                    prompt: '请输入结束时间……'
                }]
            },
            price: {
                identifier: 'price',
                rules: [{
                    type: 'empty',
                    prompt: '请输入价格……'
                }]
            },
            description: {
                identifier: 'description',
                rules: [{
                    type: 'empty',
                    prompt: '请输入备注信息……'
                }]
            }
        },
        onSuccess: function(e) {
            //阻止表单的提交
            e.preventDefault();
            var rentInfoId = window.location.pathname.split("/")[3];
            var title= $('#title').val();
            var truthName= $('#truthName').val();
            var mobile= $('#mobile').val();
            // var communityName= $('#communityName').val();
            var parkName= $('#parkName').val();
            var parkAddress= $('#parkAddress').val();
            var longFlag=$('.radio.checkbox input[name="longFlag"]:checked').val();
            //var tencent= $('#tencent').val();
            var startTime= $('#startTime').val();
            var endTime= $('#endTime').val();
            var freeFlag=$('.radio.checkbox input[name="freeFlag"]:checked').val();
            if (freeFlag==1){
                $('#fee').show();
            }
            var price= $('#price').val();
            var description= $('#description').val();
            var data = {
                title : title,
                truthName : truthName,
                mobile : mobile,
                // communityName : communityName,
                parkName : parkName,
                parkAddress : parkAddress,
                longFlag : longFlag,
                //tencent : tencent,
                startTime : startTime,
                endTime : endTime,
                freeFlag : freeFlag,
                price:price,
                description : description,
            }
            $.ajax({
                type: "POST",
                async : false,
                serializeForm: true,
                url: "/CommunityPark/editRentOutInfo/"+rentInfoId,
                data:JSON.stringify(data),
                contentType:"application/json;charset=UTF-8",
                dataType: "json",
                success: function (res) {
                    if (res.code==0){
                        alert("修改成功！")
                    }
                    else{
                        alert(res.msg);
                        alert("---修改失败！---");
                        window.location.href="getRentOutInput";
                    }
                },
                error:function (res) {
                    console.log(res.msg);
                    alert("---emmmm,你的网络有点问题！---");
                }
            });
        }
    });



</script>
</body>
</html>